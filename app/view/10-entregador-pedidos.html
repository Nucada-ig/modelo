<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script> window.FontAwesomeConfig = { autoReplaceSvg: 'nest'};</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                    },
                    colors: {
                        accent: '#475569',
                        'gray-50': '#f8fafc',
                        'gray-100': '#f1f5f9',
                        'gray-200': '#e2e8f0',
                        'gray-300': '#cbd5e1',
                        'gray-400': '#94a3b8',
                        'gray-500': '#64748b',
                        'gray-600': '#475569',
                        'gray-700': '#334155',
                        'gray-800': '#1e293b',
                        'gray-900': '#0f172a',
                    }
                }
            }
        }
    </script>
    <style>::-webkit-scrollbar { display: none;}</style>
</head>
<body class="font-inter bg-gray-50">

<header id="header" class="bg-white border-b border-gray-200 px-4 py-4 sticky top-0 z-40">
    <div class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
            <div class="w-10 h-10 bg-accent rounded-xl flex items-center justify-center">
                <i class="fa-solid fa-truck text-white text-sm"></i>
            </div>
            <div>
                <h1 class="text-lg font-semibold text-gray-900">Entregas</h1>
                <p class="text-xs text-gray-500">{{ entregador.nome }}</p>
            </div>
        </div>
        <div class="flex items-center space-x-3">
            <button class="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center">
                <i class="fa-solid fa-bell text-gray-600 text-sm"></i>
            </button>
            <a href="/entregador/perfil/{{ entregador.username }}" class="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center">
                <i class="fa-solid fa-user text-gray-600 text-sm"></i>
            </a>
        </div>
    </div>
</header>

<main id="dashboard-main" class="px-4 py-6 pb-32">
    
    <div id="filter-tabs" class="flex bg-white rounded-2xl p-1 mb-6 border border-gray-200">
        <button onclick="window.location.href='/entregador/minhas-entregas/{{ entregador.username }}'" class="flex-1 py-2 px-4 text-sm font-medium text-white bg-accent rounded-xl transition-all flex items-center justify-center gap-2">
            Minhas Entregas
            <span class="bg-white/20 px-2 py-0.5 rounded-md text-xs font-semibold">{{ entregas_ativas|length }}</span>
        </button>
        <button onclick="window.location.href='/entregador/pedidos-disponiveis/{{ entregador.username }}'" class="flex-1 py-2 px-4 text-sm font-medium text-gray-600 hover:text-gray-900 transition-all flex items-center justify-center gap-2">
            Disponíveis
            <span class="bg-gray-100 px-2 py-0.5 rounded-md text-xs font-semibold text-gray-500">{{ pedidos_disponiveis|length }}</span>
        </button>
    </div>

    <div id="deliveries-list" class="space-y-4">
        {% if not entregas_ativas %}
        <div class="bg-white rounded-2xl p-8 text-center border border-gray-200">
            <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fa-solid fa-motorcycle text-gray-400 text-2xl"></i>
            </div>
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Nenhuma entrega ativa</h3>
            <p class="text-gray-500 text-sm mb-4">Aceite pedidos disponíveis para começar a entregar</p>
            <a href="/entregador/pedidos-disponiveis/{{ entregador.username }}" class="inline-flex items-center gap-2 bg-accent text-white px-6 py-3 rounded-xl font-medium hover:bg-gray-700 transition-colors">
                <i class="fa-solid fa-search"></i>
                Ver Pedidos Disponíveis
            </a>
        </div>
        {% endif %}

        {% for pedido in entregas_ativas %}
        <div class="bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden relative">
            <div class="absolute left-0 top-0 bottom-0 w-1.5 
                {% if pedido.status == 'em_entrega' %}bg-blue-500
                {% elif pedido.status == 'coletado' %}bg-green-500
                {% else %}bg-yellow-500{% endif %}">
            </div>
            
            <div class="p-4 pl-5">
                <div class="flex items-start justify-between mb-3">
                    <div class="flex-1">
                        <div class="flex items-center space-x-2 mb-1">
                            <span class="text-sm font-bold text-gray-900">#{{ pedido.id }}</span>
                            <span class="px-2 py-0.5 
                                {% if pedido.status == 'em_entrega' %}bg-blue-100 text-blue-700
                                {% elif pedido.status == 'coletado' %}bg-green-100 text-green-700
                                {% else %}bg-yellow-100 text-yellow-700{% endif %}
                                text-[10px] font-bold uppercase tracking-wide rounded-md">
                                {{ pedido.status|replace('_', ' ') }}
                            </span>
                        </div>
                        <p class="text-sm font-medium text-gray-900">{{ pedido.cliente_nome }}</p>
                        <p class="text-xs text-gray-500 mb-2 truncate">{{ pedido.endereco_entrega }}, {{ pedido.endereco_numero }}</p>
                        
                        <div class="flex items-center gap-3 text-xs text-gray-600 bg-gray-50 p-2 rounded-lg inline-flex">
                            <div class="flex items-center gap-1">
                                {% if pedido.forma_pagamento == 'dinheiro' %}
                                <i class="fa-solid fa-money-bill-1 text-gray-400"></i>
                                <span>Dinheiro</span>
                                {% elif pedido.forma_pagamento == 'pix' %}
                                <i class="fa-solid fa-money-bill-wave text-green-500"></i>
                                <span>PIX</span>
                                {% else %}
                                <i class="fa-solid fa-credit-card text-gray-400"></i>
                                <span>Cartão</span>
                                {% endif %}
                            </div>
                            <div class="w-px h-3 bg-gray-300"></div>
                            <div class="flex items-center gap-1">
                                <i class="fa-solid fa-person-biking text-gray-400"></i>
                                <span>{{ pedido.distancia or '2.5' }} km</span>
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-lg font-bold text-gray-900">R$ {{ "%.2f"|format(pedido.preco_total) }}</div>
                    </div>
                </div>

                <div class="flex space-x-2 mt-3">
                    <a href="https://wa.me/55{{ pedido.cliente_telefone|replace('-', '')|replace(' ', '') }}?text=Olá! Sou o entregador do seu pedido %23{{ pedido.id }}. Estou a caminho!" 
                       target="_blank"
                       class="w-12 h-10 bg-green-50 text-green-600 rounded-xl flex items-center justify-center hover:bg-green-100 transition-colors border border-green-100">
                        <i class="fa-brands fa-whatsapp text-lg"></i>
                    </a>
                    <a href="/entregador/tracar-rota/{{ entregador.username }}/{{ pedido.id }}" 
                       class="flex-1 bg-accent text-white py-2 px-4 rounded-xl text-sm font-medium hover:bg-gray-700 transition-all shadow-sm flex items-center justify-center gap-2">
                        <i class="fa-solid fa-route"></i>
                        Ver Rota
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</main>

<nav id="bottom-nav" class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 py-2 pb-5 z-40">
    <div class="flex items-center justify-between relative">
        <a href="/entregador/minhas-entregas/{{ entregador.username }}" class="flex flex-col items-center py-2 px-3 w-16">
            <div class="w-6 h-6 bg-accent rounded-lg flex items-center justify-center mb-1">
                <i class="fa-solid fa-list text-white text-xs"></i>
            </div>
            <span class="text-[10px] font-medium text-accent">Entregas</span>
        </a>
        
        <a href="/entregador/mapa/{{ entregador.username }}" class="flex flex-col items-center py-2 px-3 w-16">
            <div class="w-6 h-6 bg-gray-50 rounded-lg flex items-center justify-center mb-1">
                <i class="fa-solid fa-map text-gray-400 text-xs"></i>
            </div>
            <span class="text-[10px] text-gray-400">Mapa</span>
        </a>
        
        <div class="relative w-16 flex justify-center">
            <a href="/entregador/pedidos-disponiveis/{{ entregador.username }}" class="absolute -top-10 w-16 h-16 bg-blue-600 rounded-full shadow-lg border-4 border-gray-50 text-white flex items-center justify-center hover:bg-blue-700 transition-all hover:scale-105 active:scale-95 group">
                <i class="fa-solid fa-search text-2xl"></i>
            </a>
            <span class="absolute top-8 text-[10px] font-bold text-gray-600 whitespace-nowrap">Ver Pedidos</span>
        </div>
        
        <a href="/entregador/historico/{{ entregador.username }}" class="flex flex-col items-center py-2 px-3 w-16">
            <div class="w-6 h-6 bg-gray-50 rounded-lg flex items-center justify-center mb-1">
                <i class="fa-solid fa-history text-gray-400 text-xs"></i>
            </div>
            <span class="text-[10px] text-gray-400">Histórico</span>
        </a>
        
        <a href="/entregador/perfil/{{ entregador.username }}" class="flex flex-col items-center py-2 px-3 w-16">
            <div class="w-6 h-6 bg-gray-50 rounded-lg flex items-center justify-center mb-1">
                <i class="fa-solid fa-user text-gray-400 text-xs"></i>
            </div>
            <span class="text-[10px] text-gray-400">Perfil</span>
        </a>
    </div>
</nav>

</body>
</html>